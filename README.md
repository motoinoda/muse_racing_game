# Muse Racing Game 🧠🏎️

脳波（集中度）でスピードをコントロールするレースゲーム

Muse EEGヘッドバンドから取得した脳波データをリアルタイムで解析し、集中度に応じて車のスピードが変化するインタラクティブなレーシングゲームです。

## 特徴

- **リアルタイム脳波解析**: Muse EEGデバイスから脳波データを取得し、各周波数帯域（デルタ、シータ、アルファ、ベータ、ガンマ）を解析
- **集中度計算**: ベータ波とアルファ波の比率から集中度を算出
- **インタラクティブなゲームプレイ**: 集中度が高いほど車のスピードが速くなる
- **視覚的フィードバック**: 脳波の状態、集中度、スピードをリアルタイム表示

## 必要な環境

- Python 3.11
- Muse 2
- PC（Bluetooth LE対応）

## インストール

```bash
pip install -r requirements.txt
```

## 使い方

### レースゲームの起動

```bash
python muse_racing_game.py
```

### 脳波ビューアの起動（データ確認用）

```bash
python muse_viewer.py
```

## レーシングゲームの遊び方

1. Museヘッドバンドを装着し、電源を入れる
2. 「Scan for Muse」ボタンをクリックし，デバイススキャンを開始
3. 「Connect」ボタンをクリックしてMuseデバイスに接続
4. Tutorial Mode をクリック後，Start Game をクリックし，脳波計測をテスト
5. 安静時に Contact Quality が OK もしくは Good になるまで 電極の接触を調整
6. 調整が完了したら，Stop をクリック
7. Difficulty を選択し，Start Game をクリック
8. **集中する**ことで車のスピードが上がる
9. キーボードの矢印キーでレーを移動
10. 障害物を避けながら制限時間内で，どこまで走れるのか挑戦してみよう！
11. 「βパワーの左右差でレーン移動」にチェックを入れると脳波からレーン移動が可能（βパワーの左右差を見ているので，歯ぎしりなどの筋電による操作もできます）

> [!TIP]
PCの設定によってはデバイス検索時にBluetoothの設定を確認する必要があります。
システム設定＞プライバシーとセキュリティ＞Bluetoothで，ターミナルやIDEがBluetoothにアクセスできるようにしてください。

## 技術仕様

### 脳波解析

- **サンプリングレート**: 256 Hz
- **解析窓幅**: 1秒（256サンプル）
- **窓更新方式**: スライディングウィンドウ（約0.047秒ごとに更新）
- **オーバーラップ率**: 約95.3%（12サンプルずつスライド）
- **FFT処理**: 各チャンネルの1秒窓に対してリアルタイムFFT
- **周波数帯域**:
  - Delta (δ): 0.5-4 Hz
  - Theta (θ): 4-8 Hz
  - Alpha (α): 8-13 Hz
  - Beta (β): 13-30 Hz
  - Gamma (γ): 30-49 Hz

### チャンネル構成

- **4チャンネル**: TP9（左耳後）、AF7（左前額）、AF8（右前額）、TP10（右耳後）


### 集中度計算

```
集中度 = Betaパワー / （Alphaパワー + Thetaパワー）
正規化: 0.0-1.0の範囲にクリップ
```

スピードは集中度に応じて0-100の範囲で変化します。

### 左右脳操作
- **左右平均処理**:
  - 左チャンネル = (TP9 + AF7) / 2
  - 右チャンネル = (AF8 + TP10) / 2

- **左右バイアス計算**: log(右βパワー / 左βパワー)
- **レーン変更閾値**: ±0.1
- **クールダウン**: 約0.6秒（20フレーム）



## ライセンス

MIT License

## 貢献

プルリクエストを歓迎します！バグ報告や機能提案はIssueでお願いします。

## 参考

このプロジェクトは以下のライブラリを参考にしています：
- [muse-lsl](https://github.com/alexandrebarachant/muse-lsl)
- [Muse Developer Documentation](https://web.archive.org/web/20181105231756/http://developer.choosemuse.com/tools/windows-tools/available-data-muse-direct)
